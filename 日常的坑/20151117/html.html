<!DOCTYPE html>
<html>
	<head>
		<title>html参考手册</title>
	</head>
	<body>
		<p id="demo"></p>

		<button onclick="myFunction()">试一下</button>

		<script>
		function myFunction()
		{
			var x = document.createElement("TITLE");
			var t = document.createTextNode("HTML DOM Objects");
			x.appendChild(t);
			document.head.appendChild(x);

			document.getElementById("demo").innerHTML="您已经在文档的 HEAD 部分创建了一个 TITLE 元素。";
			}
			var person ={
				name:"Mark",
				age:23
		}
		// 点记法
			console.log(person.name); // 'Mark'

			// 括号记法
			console.log(person['age']); // 23
			var key = 'name';

			console.log(person[key]); // 'Mark'
			 console.log(person.un); // 'Mark'
		var person1 ={
			'name of the person' : 'Mark',
			'age of the person' : 23
		}
		console.log(person1['name of the person']); // 'Mark'


		//js delay
		/**
		for(var j=1;j<100100111;j++){
				for(var i=1;i<10;i++){

				}
			}

			console.log(j)

			**/
	function expanded(id){
		var tree=document.createElement("div");
		tree.id="tree";
		var ul =document.createElement("ul");
		var l1= document.createElement("li");
		l1.textContent="1";
		var ul1 =document.createElement("ul");
		var l11=  document.createElement("li");
		l11.textContent="11";
		ul1.appendChild(l11);
		l1.appendChild(ul1);
		var l2=  document.createElement("li");
		var l3=  document.createElement("li");

		l2.textContent="2"
		l3.textContent="3"
		ul.appendChild(l1);
		ul.appendChild(l2);
		ul.appendChild(l3);
		tree.appendChild(ul);


		//document.body.appendChild(tree);
		//treeDataDriver(buildTreeData());

		treeDataDriver(buildArrayTreeData());
	}
	function treeDataDriver(treeData){


		var tree=document.createElement("div");
		tree.id="tree";
		var ul=buildNode(treeData)
		tree.appendChild(ul);
		document.body.appendChild(tree);

		function buildNode(nodeData){
			var ul =document.createElement("ul");
			for(var i=0;i<nodeData.length;i++){
				var node=nodeData[i];
				if(!node.child){
					var li= document.createElement("li");
					li.textContent=node.text;
					li.id=node.id;
				
					ul.appendChild(li);	
			
			}
			else{

				var li= document.createElement("li");
				li.textContent=node.text;
				li.id=node.id;
				li.appendChild(buildNode(node.child));
				li.onclick=clickT
				ul.appendChild(li);

			}

		}
			return ul;
	}
	}
	function buildTreeData(){
		var treeData=[];
		treeData.push({id:1,text:"1",child:[{id:11,text:11},{id:12,text:12,child:[{id:121,text:121},
		{id:122,text:122}]}]});
		treeData.push({id:2,text:2});
		treeData.push({id:3,text:3});
		return treeData;
	}

	function buildArrayTreeData(){
		var a=buildArray();
		//to more normal 
		//var config={id:"id",pid:"pid",isRoot:function(a){if(id&&!a[i].pid) return true}}
		//isRoot:function(){if(pid==0) return true}
		return get();
			
		function get(id){
		var treeData=[]
		for(var i=0;i<a.length;i++){
		//if((id=="0"&&!a[i].pid)||(a[i].pid==id)){//litter trick:isRoot or is id`child
		if((!id&&!a[i].pid)||(a[i].pid==id)){//sunch as 0 
		if(isParent(id)){
		var iii=a[i].id
		a[i].child=get(iii);
		treeData.push(a[i]);
		}
		else{
		treeData.push(a[i]);
		}
		}
		}	
		return 	treeData;

		  function isParent(id) {
		  if(id==0)return true;
		for ( var i = 0; i < a.length; i++) {
		  if (id == a[i].pid)
			return true;
		}
		return false;
	  }
		}

		function buildArray(){
		var a=[];
		a.push({id:1,text:"1"})
		a.push({id:2,text:"2"})
		a.push({id:21,text:"21",pid:"2"})
		a.push({id:22,text:"22",pid:"2"})
		a.push({id:23,text:"23",pid:"2"})
		a.push({id:4,text:"4"})
		a.push({id:41,text:"41",pid:"4"})
		return a;

	}
	}
	function clickT(e){
	console.log(this.textContent)
	e.stopPropagation()
	//e.preventDefault();

	}
</script>
<div id="tree">
<ul >
	<li onclick="expanded(this)">系统管理
		<ul>
			<li>部门管理</li>
			<li>岗位管理
				<ul>
					<li>岗位添加</li>
					<li>岗位删除</li>
				</ul>
			</li>
			<li>用户管理
				<ul>
					<li>添加用户</li>
					<li>修改用户</li>
				</ul>
			</li>
		</ul>
	</li>
	<li>审批流转</li>
</ul>
<div>
<style>
	#tree ul{
	list-style-type:none;
	}
	<style>
<form id ="mf" name="mfn">
<input name="a">
</form>

<style type="text/css">
<!--
body,div,p,ul,li,font,span,td,th{
font-size:10pt;
line-height:155%;
}
table{
border-top-width: 1px;
border-right-width: 1px;
border-bottom-width: 0px;
border-left-width: 1px;
border-top-style: solid;
border-right-style: solid;
border-bottom-style: none;
border-left-style: solid;
border-top-color: #CCCCCC;
border-right-color: #CCCCCC;
border-bottom-color: #CCCCCC;
border-left-color: #CCCCCC;
}
td{
border-bottom-width: 1px;
border-bottom-style: solid;
border-bottom-color: #CCCCCC;
}
.EditCell_TextBox {
width: 90%;
border:1px solid #0099CC;
}
.EditCell_DropDownList {
width: 90%;
}
-->
</style>

<form id="form1" name="form1" method="post" action="">
<h3>可编辑的表格</h3>
<table width="698" border="0" cellpadding="0" cellspacing="0" id="tabProduct">
    <tr>
      <td width="32" align="center" bgcolor="#EFEFEF" Name="Num"><input type="checkbox" name="checkbox" value="checkbox" /></td>
      <td width="186" bgcolor="#EFEFEF" Name="Num" EditType="TextBox">序号</td>
      <td width="152" bgcolor="#EFEFEF" Name="ProductName" EditType="DropDownList" DataItems="{text:'A',value:'a'},{text:'B',value:'b'},{text:'C',value:'c'},{text:'D',value:'d'}">商品名称</td>
      <td width="103" bgcolor="#EFEFEF" Name="Amount" EditType="TextBox">数量</td>
      <td width="103" bgcolor="#EFEFEF" Name="Price" EditType="TextBox">单价</td>
      <td width="120" bgcolor="#EFEFEF" Name="SumMoney" Expression="Amount*Price" Format="#,###.00">合计</td>
    </tr>
    <tr>
      <td align="center" bgcolor="#FFFFFF"><input type="checkbox" name="checkbox2" value="checkbox" /></td>
      <td bgcolor="#FFFFFF">1</td>
      <td bgcolor="#FFFFFF" Value="c">C</td>
      <td bgcolor="#FFFFFF">0</td>
      <td bgcolor="#FFFFFF">0</td>
      <td bgcolor="#FFFFFF">0</td>
    </tr>
    <tr>
      <td align="center" bgcolor="#FFFFFF"><input type="checkbox" name="checkbox22" value="checkbox" /></td>
      <td bgcolor="#FFFFFF">2</td>
      <td bgcolor="#FFFFFF" Value="d">D</td>
      <td bgcolor="#FFFFFF">0</td>
      <td bgcolor="#FFFFFF">0</td>
      <td bgcolor="#FFFFFF">0</td>
    </tr>
</table>

<br />
<input type="button" name="Submit" value="新增" onclick="AddRow(document.getElementById('tabProduct'),1)" />
<input type="button" name="Submit2" value="删除" onclick="DeleteRow(document.getElementById('tabProduct'),1)" />
<input type="button" name="Submit22" value="重置" onclick="window.location.reload()" />
<input type="submit" name="Submit3" value="提交" onclick="GetTableData(document.getElementById('tabProduct'));return false;" />
</form>

<script language="javascript" src="GridEdit.js"></script>
<script language="javascript">
var tabProduct = document.getElementById("tabProduct");

// 设置表格可编辑
// 可一次设置多个，例如：EditTables(tb1,tb2,tb2,......)
EditTables(tabProduct);
/**
* JS实现可编辑的表格  
* 用法:EditTables(tb1,tb2,tb2,......);
* Create by Senty at 2008-04-12
**/

//设置多个表格可编辑
function EditTables(){
for(var i=0;i<arguments.length;i++){
   SetTableCanEdit(arguments[i]);
}
}

//设置表格是可编辑的
function SetTableCanEdit(table){
for(var i=1; i<table.rows.length;i++){
   SetRowCanEdit(table.rows[i]);
}
}

function SetRowCanEdit(row){
for(var j=0;j<row.cells.length; j++){

   //如果当前单元格指定了编辑类型，则表示允许编辑
   var editType = row.cells[j].getAttribute("EditType");
   if(!editType){
    //如果当前单元格没有指定，则查看当前列是否指定
    editType = row.parentNode.rows[0].cells[j].getAttribute("EditType");
   }
   if(editType){
    row.cells[j].onclick = function (){
     EditCell(this);
    }
   }
}

}

//设置指定单元格可编辑
function EditCell(element, editType){

var editType = element.getAttribute("EditType");
if(!editType){
   //如果当前单元格没有指定，则查看当前列是否指定
   editType = element.parentNode.parentNode.rows[0].cells[element.cellIndex].getAttribute("EditType");
}

switch(editType){
   case "TextBox":
    CreateTextBox(element, element.innerHTML);
    break;
   case "DropDownList":
    CreateDropDownList(element);
    break;
   default:
    break;
}
}

//为单元格创建可编辑输入框
function CreateTextBox(element, value){
//检查编辑状态，如果已经是编辑状态，跳过
var editState = element.getAttribute("EditState");
if(editState != "true"){
   //创建文本框
   var textBox = document.createElement("INPUT");
   textBox.type = "text";
   textBox.className="EditCell_TextBox";
  
  
   //设置文本框当前值
   if(!value){
    value = element.getAttribute("Value");
   }  
   textBox.value = value;
  
   //设置文本框的失去焦点事件
   textBox.onblur = function (){
    CancelEditCell(this.parentNode, this.value);
   }
   //向当前单元格添加文本框
   ClearChild(element);
   element.appendChild(textBox);
   textBox.focus();
   textBox.select();
  
   //改变状态变量
   element.setAttribute("EditState", "true");
   element.parentNode.parentNode.setAttribute("CurrentRow", element.parentNode.rowIndex);
}

}


//为单元格创建选择框
function CreateDropDownList(element, value){
//检查编辑状态，如果已经是编辑状态，跳过
var editState = element.getAttribute("EditState");
if(editState != "true"){
   //创建下接框
   var downList = document.createElement("Select");
   downList.className="EditCell_DropDownList";
  
   //添加列表项
   var items = element.getAttribute("DataItems");
   if(!items){
    items = element.parentNode.parentNode.rows[0].cells[element.cellIndex].getAttribute("DataItems");
   }
  
   if(items){
    items = eval("[" + items + "]");
    for(var i=0; i<items.length; i++){
     var oOption = document.createElement("OPTION");
     oOption.text = items[i].text;
     oOption.value = items[i].value;
     downList.options.add(oOption);
    }
   }
  
   //设置列表当前值
   if(!value){
    value = element.getAttribute("Value");
   }
   downList.value = value;

   //设置创建下接框的失去焦点事件
   downList.onblur = function (){
    CancelEditCell(this.parentNode, this.value, this.options[this.selectedIndex].text);
   }
  
   //向当前单元格添加创建下接框
   ClearChild(element);
   element.appendChild(downList);
   downList.focus();
  
   //记录状态的改变
   element.setAttribute("EditState", "true");
   element.parentNode.parentNode.setAttribute("LastEditRow", element.parentNode.rowIndex);
}

}


//取消单元格编辑状态
function CancelEditCell(element, value, text){
element.setAttribute("Value", value);
if(text){
   element.innerHTML = text;
}else{
   element.innerHTML = value;
}
element.setAttribute("EditState", "false");

//检查是否有公式计算
CheckExpression(element.parentNode);
}

//清空指定对象的所有字节点
function ClearChild(element){
element.innerHTML = "";
}

//添加行
function AddRow(table, index){
var lastRow = table.rows[table.rows.length-1];
var newRow = lastRow.cloneNode(true);
table.tBodies[0].appendChild(newRow);
SetRowCanEdit(newRow);
return newRow;

}


//删除行
function DeleteRow(table, index){
for(var i=table.rows.length - 1; i>0;i--){
   var chkOrder = table.rows[i].cells[0].firstChild;
   if(chkOrder){
    if(chkOrder.type = "CHECKBOX"){
     if(chkOrder.checked){
      //执行删除
      table.deleteRow(i);
     }
    }
   }
}
}

//提取表格的值,JSON格式
function GetTableData(table){
var tableData = new Array();
alert("行数：" + table.rows.length);
for(var i=1; i<table.rows.length;i++){
   tableData.push(GetRowData(tabProduct.rows[i]));
}

return tableData;

}
//提取指定行的数据，JSON格式
function GetRowData(row){
var rowData = {};
for(var j=0;j<row.cells.length; j++){
   name = row.parentNode.rows[0].cells[j].getAttribute("Name");
   if(name){
    var value = row.cells[j].getAttribute("Value");
    if(!value){
     value = row.cells[j].innerHTML;
    }
   
    rowData[name] = value;
   }
}
//alert("ProductName:" + rowData.ProductName);
//或者这样：alert("ProductName:" + rowData["ProductName"]);
return rowData;

}

//检查当前数据行中需要运行的字段
function CheckExpression(row){
for(var j=0;j<row.cells.length; j++){
   expn = row.parentNode.rows[0].cells[j].getAttribute("Expression");
   //如指定了公式则要求计算
   if(expn){
    var result = Expression(row,expn);
    var format = row.parentNode.rows[0].cells[j].getAttribute("Format");
    if(format){
     //如指定了格式，进行字值格式化
     row.cells[j].innerHTML = formatNumber(Expression(row,expn), format);
    }else{
     row.cells[j].innerHTML = Expression(row,expn);
    }
   }
  
}
}

//计算需要运算的字段
function Expression(row, expn){
var rowData = GetRowData(row);
//循环代值计算
for(var j=0;j<row.cells.length; j++){
   name = row.parentNode.rows[0].cells[j].getAttribute("Name");
   if(name){
    var reg = new RegExp(name, "i");
    expn = expn.replace(reg, rowData[name].replace(/\,/g, ""));
   }
}
return eval(expn);
}

///////////////////////////////////////////////////////////////////////////////////
/**
* 格式化数字显示方式  
* 用法
* formatNumber(12345.999,'#,##0.00');
* formatNumber(12345.999,'#,##0.##');
* formatNumber(123,'000000');
* @param num
* @param pattern
*/
/* 以下是范例
formatNumber('','')=0
formatNumber(123456789012.129,null)=123456789012
formatNumber(null,null)=0
formatNumber(123456789012.129,'#,##0.00')=123,456,789,012.12
formatNumber(123456789012.129,'#,##0.##')=123,456,789,012.12
formatNumber(123456789012.129,'#0.00')=123,456,789,012.12
formatNumber(123456789012.129,'#0.##')=123,456,789,012.12
formatNumber(12.129,'0.00')=12.12
formatNumber(12.129,'0.##')=12.12
formatNumber(12,'00000')=00012
formatNumber(12,'#.##')=12
formatNumber(12,'#.00')=12.00
formatNumber(0,'#.##')=0
*/
function formatNumber(num,pattern){  
var strarr = num?num.toString().split('.'):['0'];  
var fmtarr = pattern?pattern.split('.'):[''];  
var retstr='';  
  
// 整数部分  
var str = strarr[0];  
var fmt = fmtarr[0];  
var i = str.length-1;    
var comma = false;  
for(var f=fmt.length-1;f>=0;f--){  
    switch(fmt.substr(f,1)){  
      case '#':  
        if(i>=0 ) retstr = str.substr(i--,1) + retstr;  
        break;  
      case '0':  
        if(i>=0) retstr = str.substr(i--,1) + retstr;  
        else retstr = '0' + retstr;  
        break;  
      case ',':  
        comma = true;  
        retstr=','+retstr;  
        break;  
    }  
}  
if(i>=0){  
    if(comma){  
      var l = str.length;  
      for(;i>=0;i--){  
        retstr = str.substr(i,1) + retstr;  
        if(i>0 && ((l-i)%3)==0) retstr = ',' + retstr;   
      }  
    }  
    else retstr = str.substr(0,i+1) + retstr;  
}  
  
retstr = retstr+'.';  
// 处理小数部分  
str=strarr.length>1?strarr[1]:'';  
fmt=fmtarr.length>1?fmtarr[1]:'';  
i=0;  
for(var f=0;f<fmt.length;f++){  
    switch(fmt.substr(f,1)){  
      case '#':  
        if(i<str.length) retstr+=str.substr(i++,1);  
        break;  
      case '0':  
        if(i<str.length) retstr+= str.substr(i++,1);  
        else retstr+='0';  
        break;  
    }  
}  
return retstr.replace(/^,+/,'').replace(/\.$/,'');  
}

</script>

<table>
<tr>
<td>
<textarea rows="3" cols="120" id="sql">
select * from fdmenu LIMIT 5 
</textarea>
<!--  
<input id="sql" value="select * from fdmenu LIMIT 2" style="width:350px">
-->
</td>
<td>
<z:tbutton	onClick="querySql();">
					<img src="../Icons/icon002a21.gif" />运行sql</z:tbutton>
</td>
</tr>
</table>
<div id="t"></div>
<div style="height:30px"></div>
<style type="text/css">
#customers
  {
  font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
  width:100%;
  border-collapse:collapse;
  }

#customers td, #customers th 
  {
  font-size:1em;
  border:1px solid #98bf21;
  padding:3px 7px 2px 7px;
  }

#customers tr:first-child
  {
  font-size:1.1em;
  text-align:left;
  padding-top:5px;
  padding-bottom:4px;
  background-color:#A7C942;
  color:#ffffff;
  }
#customers td:first-child
  {
  font-size:1.1em;
  text-align:left;
  padding-top:5px;
  padding-bottom:4px;
  background-color:#EAF2D3;
  color:#000000;
  width:30px;
  }
#customers tr:hover td 
  {
  color:#000000;
  background-color:#EAF2D3;
  }
</style>

<script>
function querySql(){
	Server.sendRequest("com.sinosoft.jbs.basicdata.FDInscomManageUITest.submitData",buildDataCollection(),responseFunc)
	/*
	构造要传递的参数
	*/
	function buildDataCollection (){
		var sql=document.getElementById("sql").value;
		var d=new DataCollection();
		d.add("sql",sql)
		return d
	}
	/*对响应进行处理*/
	function  responseFunc (response){
		var dataTable=buildDataTableFromResponse(response);
		var a=document.getElementById("t");
		a.innerHTML=buildTableHtml(dataTable);
		/*从返回信息中构造数据表格*/
		
		function buildDataTableFromResponse(response){
			var dataTable=[];
			if(response.Status=="0"){
				//Dialog.alert(response.Message);
			}
			var trs=response.Message.split("\n");
			for(var i=0;i<trs.length;i++){
				dataTable.push(trs[i].split("\t"));	
			}
			return dataTable;
			
		}
		/*将数据表格构造成html*/
		function buildTableHtml(dataTable){
			var trs=dataTable;
			var table="<table id='customers'>";
			for(var i=0;i<trs.length;i++){
				table+="<tr>";
				var tds=trs[i];
				if(tds.length){//序数列
					if(i!=0){
						table+="<td>";
						table+=i;
						table+="</td>";
					}
					else{//0 0格子占位
						table+="<td>";
						table+="";
						table+="</td>";
					}
					
				}
				for(var j=0;j<tds.length;j++){
					table+="<td>";
					table+=tds[j];
					table+="</td>";
				}
				table+="</tr>";
			}
			table+="</table>";
			return table;
		}
	}


}
//querySql();


</script>
</body>
</html>
													